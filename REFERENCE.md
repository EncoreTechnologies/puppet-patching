# Reference
<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

**Functions**

* [`patching::snapshot_vmware`](#patchingsnapshot_vmware): 

**Tasks**

* [`available_updates`](#available_updates): Collects information about available updates on a target system
* [`cache_remove`](#cache_remove): Removes/clears the target's update cache. For RHEL/CentOS this means a `yum clean all`. For Debian this means a `apt update`. For Windows thi
* [`cache_update`](#cache_update): Updates the targets update cache. For RHEL/CentOS this means a `yum makecache fast`. For Debian this means a `apt update`. For Windows this m
* [`history`](#history): Reads the update history from the JSON 'result_file'.
* [`post_patch`](#post_patch): Run post-patching script on target host(s), only if it exists. If the patching script doesn't exist or isn't executable, then this task succe
* [`pre_patch`](#pre_patch): Run pre-patching script on target host(s), only if it exists. If the patching script doesn't exist or isn't executable, then this task succee
* [`puppet_facts`](#puppet_facts): Gather system facts using 'puppet facts'. Puppet agent MUST be installed for this to work.
* [`reboot_required`](#reboot_required): Checks if a reboot is pending
* [`update`](#update): Execute OS updates on the target. For RedHat/CentOS this runs `yum update`. For Debian/Ubuntu runs `apt upgrade`. For Windows this runs Windo
* [`update_history`](#update_history): Reads the update history from the JSON 'result_file'.

**Plans**

* [`patching`](#patching): Bolt plan to update hosts (linux and windows together)
* [`patching::available_updates`](#patchingavailable_updates): 
* [`patching::check_online`](#patchingcheck_online): Checks each node to see if Puppet is installed, if it is then gather Facts
* [`patching::check_puppet`](#patchingcheck_puppet): Checks each node to see if Puppet is installed, if it is then gather Facts
* [`patching::get_targets`](#patchingget_targets): 
* [`patching::ordered_groups`](#patchingordered_groups): 
* [`patching::patch_helper`](#patchingpatch_helper): 
* [`patching::post_patch`](#patchingpost_patch): 
* [`patching::pre_patch`](#patchingpre_patch): 
* [`patching::puppet_facts`](#patchingpuppet_facts): Plan the runs 'puppet facts' on the target nodes and sets them as facts on the Target objects.  This is inspired by: https://github.com/puppe
* [`patching::reboot_required`](#patchingreboot_required): Bolt plan to check if targets need reboot and have patch_reboot flag set.
* [`patching::snapshot_vmware`](#patchingsnapshot_vmware): Creates or deletes VM snapshot on supplied nodes.  NOTE1: rbvmomi gem must be installed on the localhost for this plan to function.        /o
* [`patching::update_history`](#patchingupdate_history): Bolt plan to collect update history from hosts

## Functions

### patching::snapshot_vmware

Type: Ruby 4.x API

The patching::snapshot_vmware function.

#### `patching::snapshot_vmware(Array $vm_names, String $snapshot_name, String $vsphere_host, String $vsphere_username, String $vsphere_password, String $vsphere_datacenter, Optional[Boolean] $vsphere_insecure, Optional[String] $snapshot_description, Optional[Boolean] $snapshot_memory, Optional[Boolean] $snapshot_quiesce, Optional[String] $action)`

The patching::snapshot_vmware function.

Returns: `Array`

##### `vm_names`

Data type: `Array`



##### `snapshot_name`

Data type: `String`



##### `vsphere_host`

Data type: `String`



##### `vsphere_username`

Data type: `String`



##### `vsphere_password`

Data type: `String`



##### `vsphere_datacenter`

Data type: `String`



##### `vsphere_insecure`

Data type: `Optional[Boolean]`



##### `snapshot_description`

Data type: `Optional[String]`



##### `snapshot_memory`

Data type: `Optional[Boolean]`



##### `snapshot_quiesce`

Data type: `Optional[Boolean]`



##### `action`

Data type: `Optional[String]`



## Tasks

### available_updates

Collects information about available updates on a target system

**Supports noop?** true

#### Parameters

##### `provider`

Data type: `Optional[String[1]]`

What update provider to use. For Linux (RHEL, Debian, etc) this parameter is not used. For Windows the available values are: 'windows', 'chocolatey', 'all' (both 'windows' and 'chocolatey'). The default value for Windows is 'all'. If 'all' is passed and Chocolatey isn't installed then Chocolatey will simply be skipped. If 'chocolatey' is passed and Chocolatey isn't installed, then this will error.

### cache_remove

Removes/clears the target's update cache. For RHEL/CentOS this means a `yum clean all`. For Debian this means a `apt update`. For Windows this means a Windows Update refresh.

**Supports noop?** false

### cache_update

Updates the targets update cache. For RHEL/CentOS this means a `yum makecache fast`. For Debian this means a `apt update`. For Windows this means a Windows Update refresh.

**Supports noop?** true

### history

Reads the update history from the JSON 'result_file'.

**Supports noop?** false

#### Parameters

##### `result_file`

Data type: `Optional[String[1]]`

Log file for patching results. This file will contain the JSON output that is returned from these tasks. This is data that was written by patching::update. If no script name is passed on Linux hosts a default is used: /var/log/patching.json. If no script name is passed  on Windows hosts a default is used: C:/ProgramData/PuppetLabs/patching/patching.json

### post_patch

Run post-patching script on target host(s), only if it exists. If the patching script doesn't exist or isn't executable, then this task succeeds (this allows us to run thist task on all hosts, even if they don't have a post-patching script).

**Supports noop?** true

#### Parameters

##### `script`

Data type: `Optional[String[1]]`

Absolute path of the script to execute. If no script name is passed on Linux hosts a default is used: /opt/patching/bin/post_patch.sh. If no script name is passed  on Windows hosts a default is used: C:/ProgramData/patching/bin/post_patch.ps1.

### pre_patch

Run pre-patching script on target host(s), only if it exists. If the patching script doesn't exist or isn't executable, then this task succeeds (this allows us to run thist task on all hosts, even if they don't have a pre-patching script).

**Supports noop?** true

#### Parameters

##### `script`

Data type: `Optional[String[1]]`

Absolute path of the script to execute. If no script name is passed on Linux hosts a default is used: /opt/patching/bin/pre_patch.sh. If no script name is passed  on Windows hosts a default is used: C:/ProgramData/patching/bin/pre_patch.ps1.

### puppet_facts

Gather system facts using 'puppet facts'. Puppet agent MUST be installed for this to work.

**Supports noop?** false

### reboot_required

Checks if a reboot is pending

**Supports noop?** false

### update

Execute OS updates on the target. For RedHat/CentOS this runs `yum update`. For Debian/Ubuntu runs `apt upgrade`. For Windows this runs Windows Update and `choco update`.

**Supports noop?** false

#### Parameters

##### `provider`

Data type: `Optional[String[1]]`

What update provider to use. For Linux (RHEL, Debian, etc) this parameter is not used. For Windows the available values are: 'windows', 'chocolatey', 'all' (both 'windows' and 'chocolatey'). The default value for Windows is 'all'. If 'all' is passed and Chocolatey isn't installed then Chocolatey will simply be skipped. If 'chocolatey' is passed and Chocolatey isn't installed, then this will error.

##### `names`

Data type: `Optional[Array[String]]`

Name of the package(s) to update. If nothing is passed then all packages will be updated.

##### `result_file`

Data type: `Optional[String[1]]`

Log file for patching results. This file will contain the JSON output that is returned from these tasks. The data is written to a log file so that you can collect it later by running patching::history. If no script name is passed on Linux hosts a default is used: /var/log/patching.json. If no script name is passed  on Windows hosts a default is used: C:/ProgramData/PuppetLabs/patching/patching.json

##### `log_file`

Data type: `Optional[String[1]]`

Log file for OS specific output during the patching process. This file will contain OS specific (RHEL/CentOS = yum history, Debian/Ubuntu = /var/log/apt/history.log, Windows = ??) data that this task used to generate its output. If no script name is passed on Linux hosts a default is used: /var/log/patching.log. If no script name is passed  on Windows hosts a default is used: C:/ProgramData/PuppetLabs/patching/patching.log

### update_history

Reads the update history from the JSON 'result_file'.

**Supports noop?** false

#### Parameters

##### `result_file`

Data type: `Optional[String[1]]`

Log file for patching results. This file will contain the JSON output that is returned from these tasks. This is data that was written by patching::update. If no script name is passed on Linux hosts a default is used: /var/log/patching.json. If no script name is passed  on Windows hosts a default is used: C:/ProgramData/PuppetLabs/patching/patching.json

## Plans

### patching

Bolt plan to update hosts (linux and windows together)

#### Parameters

The following parameters are available in the `patching` plan.

##### `nodes`

Data type: `TargetSpec`



##### `filter_offline_nodes`

Data type: `Boolean`



Default value: `false`

##### `pre_patch_plan`

Data type: `String`



Default value: 'patching::pre_patch'

##### `post_patch_plan`

Data type: `String`



Default value: 'patching::post_patch'

##### `reboot`

Data type: `Boolean`



Default value: `true`

##### `reboot_message`

Data type: `String`



Default value: 'NOTICE: This system is currently being updated.'

##### `snapshot_plan`

Data type: `Optional[String]`



Default value: 'patching::snapshot_vmware'

##### `snapshot_create`

Data type: `Boolean`



Default value: `true`

##### `snapshot_delete`

Data type: `Boolean`



Default value: `true`

##### `noop`

Data type: `Boolean`



Default value: `false`

### patching::available_updates

The patching::available_updates class.

#### Parameters

The following parameters are available in the `patching::available_updates` plan.

##### `nodes`

Data type: `TargetSpec`



##### `format`

Data type: `Enum["none", "pretty", "csv"]`



Default value: "pretty"

##### `noop`

Data type: `Boolean`



Default value: `false`

### patching::check_online

Checks each node to see if Puppet is installed, if it is then gather Facts

#### Parameters

The following parameters are available in the `patching::check_online` plan.

##### `nodes`

Data type: `TargetSpec`



### patching::check_puppet

Checks each node to see if Puppet is installed, if it is then gather Facts

#### Parameters

The following parameters are available in the `patching::check_puppet` plan.

##### `nodes`

Data type: `TargetSpec`



##### `filter_offline_nodes`

Data type: `Boolean`



Default value: `false`

### patching::get_targets

The patching::get_targets class.

#### Parameters

The following parameters are available in the `patching::get_targets` plan.

##### `nodes`

Data type: `TargetSpec`



### patching::ordered_groups

The patching::ordered_groups class.

#### Parameters

The following parameters are available in the `patching::ordered_groups` plan.

##### `nodes`

Data type: `TargetSpec`



### patching::patch_helper

The patching::patch_helper class.

#### Parameters

The following parameters are available in the `patching::patch_helper` plan.

##### `nodes`

Data type: `TargetSpec`



##### `task`

Data type: `String[1]`



##### `script_linux`

Data type: `Optional[String[1]]`



Default value: `undef`

##### `script_windows`

Data type: `Optional[String[1]]`



Default value: `undef`

##### `noop`

Data type: `Boolean`



Default value: `false`

### patching::post_patch

The patching::post_patch class.

#### Parameters

The following parameters are available in the `patching::post_patch` plan.

##### `nodes`

Data type: `TargetSpec`



##### `script_linux`

Data type: `String[1]`



Default value: '/opt/patching/bin/post_patch.sh'

##### `script_windows`

Data type: `String[1]`



Default value: 'C:\ProgramData\PuppetLabs\patching\post_patch.ps1'

##### `noop`

Data type: `Boolean`



Default value: `false`

### patching::pre_patch

The patching::pre_patch class.

#### Parameters

The following parameters are available in the `patching::pre_patch` plan.

##### `nodes`

Data type: `TargetSpec`



##### `script_linux`

Data type: `String[1]`



Default value: '/opt/patching/bin/pre_patch.sh'

##### `script_windows`

Data type: `String[1]`



Default value: 'C:\ProgramData\PuppetLabs\patching\pre_patch.ps1'

##### `noop`

Data type: `Boolean`



Default value: `false`

### patching::puppet_facts

Plan the runs 'puppet facts' on the target nodes and sets them as facts on
the Target objects.

This is inspired by: https://github.com/puppetlabs/puppetlabs-facts/blob/master/plans/init.pp
Except instead of just running `facter` it runs `puppet facts` to set additional
facts that are only present when in the context of puppet.

#### Parameters

The following parameters are available in the `patching::puppet_facts` plan.

##### `nodes`

Data type: `TargetSpec`



### patching::reboot_required

Bolt plan to check if targets need reboot and have patch_reboot flag set.

#### Parameters

The following parameters are available in the `patching::reboot_required` plan.

##### `nodes`

Data type: `TargetSpec`



##### `reboot`

Data type: `Boolean`



Default value: `false`

##### `message`

Data type: `String`



Default value: 'NOTICE: This system is currently being updated.'

##### `noop`

Data type: `Boolean`



Default value: `false`

### patching::snapshot_vmware

Creates or deletes VM snapshot on supplied nodes.

NOTE1: rbvmomi gem must be installed on the localhost for this plan to function.
       /opt/puppetlabs/bolt/bin/gem install --user-install rbvmomi

NOTE2: rbvmomi requires the following packages:
       - zlib-devel
       - libxslt-devel
       - patch
       - gcc

NOTE3: This plan will attempt to collect vsphere parameters from the inventory
       file for the vsphere host name, username, password and datacenter based
       on the variables for the first node specified in TargetSpec.

#### Parameters

The following parameters are available in the `patching::snapshot_vmware` plan.

##### `nodes`

Data type: `TargetSpec`



##### `action`

Data type: `Enum['create', 'delete']`



##### `vm_name_property`

Data type: `Enum['name', 'uri']`



Default value: 'uri'

##### `vsphere_host`

Data type: `String[1]`



Default value: .vars['vsphere_host']

##### `vsphere_username`

Data type: `String[1]`



Default value: .vars['vsphere_username']

##### `vsphere_password`

Data type: `String[1]`



Default value: .vars['vsphere_password']

##### `vsphere_datacenter`

Data type: `String[1]`



Default value: .vars['vsphere_datacenter']

##### `vsphere_insecure`

Data type: `Boolean`



Default value: .vars['vsphere_insecure']

##### `snapshot_name`

Data type: `String[1]`



Default value: 'Bolt Patching Snapshot'

##### `snapshot_description`

Data type: `String`



Default value: ''

##### `snapshot_memory`

Data type: `Boolean`



Default value: `false`

##### `snapshot_quiesce`

Data type: `Boolean`



Default value: `true`

##### `noop`

Data type: `Boolean`



Default value: `false`

### patching::update_history

Bolt plan to collect update history from hosts

#### Parameters

The following parameters are available in the `patching::update_history` plan.

##### `nodes`

Data type: `TargetSpec`



##### `history`

Data type: `Optional[ResultSet]`



Default value: `undef`

##### `environment`

Data type: `String`



Default value: 'default'

##### `report_file`

Data type: `String`



Default value: 'patching_report.csv'

##### `mail_from`

Data type: `Optional[String]`



Default value: `undef`

##### `mail_to`

Data type: `Optional[String]`



Default value: `undef`

##### `format`

Data type: `Enum["none", "pretty", "csv"]`



Default value: "pretty"

